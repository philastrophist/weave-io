
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../objects/">
      
      
        <link rel="next" href="../tables/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.5">
    
    
      
        <title>Building queries - WEAVE-IO</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#identifying-filtering-and-aggregating" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="WEAVE-IO" class="md-header__button md-logo" aria-label="WEAVE-IO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WEAVE-IO
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Building queries
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="WEAVE-IO" class="md-nav__button md-logo" aria-label="WEAVE-IO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    WEAVE-IO
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Outline
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-by-example/" class="md-nav__link">
        Quickstart by example
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user-installation.md" class="md-nav__link">
        User
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../admin-installation.md" class="md-nav__link">
        Admin
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../database-connector/" class="md-nav__link">
        The database connector
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="true">
          Reading
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reading" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reading
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../objects/" class="md-nav__link">
        Objects and their attributes
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Building queries
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Building queries
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#finding-objects-by-their-unique-identifiers" class="md-nav__link">
    Finding objects by their unique identifiers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering" class="md-nav__link">
    Filtering
  </a>
  
    <nav class="md-nav" aria-label="Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-a-python-value-filter-spectra-to-those-with-snr-greater-than-10" class="md-nav__link">
    Using a python value: Filter spectra to those with SNR greater than 10
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-queries-filter-spectra-to-those-with-snr-greater-the-average-snr-of-all-spectra-in-the-database" class="md-nav__link">
    Using queries: Filter spectra to those with SNR greater the average SNR of all spectra in the database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation" class="md-nav__link">
    Aggregation
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tables/" class="md-nav__link">
        Designing result tables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../splitting/" class="md-nav__link">
        Splitting queries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../stacking/" class="md-nav__link">
        Stacking, aligning, and joining
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../syntax-summary/" class="md-nav__link">
        Syntax summary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" tabindex="0" aria-expanded="false">
          Maintenance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Maintenance" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Maintenance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schema/" class="md-nav__link">
        Schema
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../writing.md" class="md-nav__link">
        Writing to the database
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#finding-objects-by-their-unique-identifiers" class="md-nav__link">
    Finding objects by their unique identifiers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering" class="md-nav__link">
    Filtering
  </a>
  
    <nav class="md-nav" aria-label="Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-a-python-value-filter-spectra-to-those-with-snr-greater-than-10" class="md-nav__link">
    Using a python value: Filter spectra to those with SNR greater than 10
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-queries-filter-spectra-to-those-with-snr-greater-the-average-snr-of-all-spectra-in-the-database" class="md-nav__link">
    Using queries: Filter spectra to those with SNR greater the average SNR of all spectra in the database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation" class="md-nav__link">
    Aggregation
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="identifying-filtering-and-aggregating">Identifying, filtering and aggregating</h1>
<h2 id="finding-objects-by-their-unique-identifiers">Finding objects by their unique identifiers</h2>
<p>If an object defines an idname in its class definition, you can find it in a query by using square brackets:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="mi">2345</span><span class="p">]</span>
</code></pre></div>
This will return a query pointed at a single ob from which you can continue the query:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="mi">2345</span><span class="p">]</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="o">...</span>
</code></pre></div>
<p>You can also access more than one object by listing them in the square brackets:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="mi">2345</span><span class="p">,</span> <span class="mi">3443</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>You can only filter by id if the object is uniquely defined (i.e. specifies an <code>idname</code> in its definition).
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="ne">ValueError</span><span class="p">:</span> <span class="n">L1SingleSpectrum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">globally</span> <span class="n">uniquely</span> <span class="n">defined</span>
</code></pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Cardinality still applies when filtering by id!
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">all_spectra</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">l1single_spectra</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">an_ob</span> <span class="o">=</span> <span class="n">all_spectra</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="mi">1234</span><span class="p">]</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">an_ob</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">[</span><span class="mi">1234</span><span class="p">,</span> <span class="mi">1234</span><span class="p">,</span> <span class="mi">1234</span><span class="p">,</span> <span class="mi">1234</span><span class="p">,</span> <span class="mi">1234</span><span class="p">,</span> <span class="mi">1234</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="mi">1234</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="mi">1234</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">all_spectra</span><span class="o">.</span><span class="n">ob</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="mi">8452</span>  <span class="c1"># doesnt have to be the same here </span>
</code></pre></div></p>
</div>
<p>Once you've traversed to an attribute, you can filter and aggregate.</p>
<h2 id="filtering">Filtering</h2>
<p>You can reduce the cardinality of a query structure by filtering either by id as above, or by a boolean mask constructed as part of the query.</p>
<p>You can create the mask by comparing either multiple queries or a query with a python value:</p>
<h4 id="using-a-python-value-filter-spectra-to-those-with-snr-greater-than-10">Using a python value: Filter spectra to those with SNR greater than 10</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">data</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="o">.</span><span class="n">snr</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">]</span>
</code></pre></div>
<h4 id="using-queries-filter-spectra-to-those-with-snr-greater-the-average-snr-of-all-spectra-in-the-database">Using queries: Filter spectra to those with SNR greater the average SNR of all spectra in the database</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">data</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="o">.</span><span class="n">snr</span> <span class="o">&gt;</span> <span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="o">.</span><span class="n">snr</span><span class="p">)]</span>
</code></pre></div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>You cannot filter an object by a boolean mask which does not have said object in its history.
All of these will fail: 
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="ne">TypeError</span><span class="p">:</span> <span class="n">Cannot</span> <span class="nb">filter</span> <span class="n">a</span> <span class="n">query</span> <span class="n">by</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">query</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">mjd</span> <span class="o">&lt;</span> <span class="n">today</span><span class="p">()]</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">CardinalityError</span><span class="p">:</span> <span class="n">Cannot</span> <span class="nb">filter</span> <span class="o">&lt;</span><span class="n">ObjectQuery</span> <span class="n">L1singleSpectrum</span><span class="o">&gt;</span> <span class="n">relative</span> <span class="n">to</span> <span class="o">&lt;</span><span class="n">ObjectQuery</span> <span class="n">OB</span><span class="o">&gt;</span> <span class="n">since</span> <span class="n">it</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">parent</span><span class="o">.</span>
</code></pre></div></p>
</div>
<h2 id="aggregation">Aggregation</h2>
<p>A query is a chain of objects and attributes (maybe a combination of more than one chain if you've compared or performed arithmetic).
You can aggregate the end of this chain structure relative to some other point in the chain.
This is similar to groupby-apply in SQL except that everything is already implicitly grouped in <code>weaveio</code>.
<code>weaveio</code> defines the aggregation function: <code>sum, max, min, mean, std, count, any, all, exists</code>.</p>
<p>For example:</p>
<p>Count the number of objects in the database:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">count</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="p">)()</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="mi">30</span>
</code></pre></div>
<p>Count the number of objects <strong>with respect to another</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">count</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="p">)()</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">result</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="p">[</span><span class="mi">902</span><span class="p">,</span> <span class="mi">945</span><span class="p">,</span> <span class="mi">854</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># this is the length of the python list not the count of the query</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="mi">30</span>
</code></pre></div>
<p>All aggregation functions work in the same way: define a long query chain and use <code>wrt=</code> to select the point in the chain you wish to aggregate to.
The resulting structure will have the same cardinality as the query given in the <code>wrt</code> argument.
If <code>wrt</code> is not given, <code>weaveio</code> will assume you mean <code>wrt=database</code> and will always return a singular result.</p>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>You may only aggregate a query relative to a point in its history.
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">count</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">runs</span><span class="p">)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">CardinalityError</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">aggregate</span> <span class="o">&lt;</span><span class="n">ObjectQuery</span> <span class="n">OB</span><span class="o">-</span><span class="n">L1singleSpectrum</span><span class="o">&gt;</span> <span class="n">relative</span> <span class="n">to</span> <span class="o">&lt;</span><span class="n">ObjectQuery</span> <span class="n">Run</span><span class="o">&gt;</span> <span class="n">since</span> <span class="n">it</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">parent</span><span class="o">.</span>
</code></pre></div></p>
</div>
<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Moreover, you can only currently do aggregate to a point that was explicitly traversed before.
The chain <code>data.obs.l1single_spectra</code> implicitly goes through <code>runs</code> because each <code>L1SingleSpectrum</code> originates from one run, 
which originates from one OB.
However, the following fails because <code>run</code> was not mentioned explicitly in the query before:
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">count</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">l1single_spectra</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">runs</span><span class="p">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">CardinalityError</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">aggregate</span> <span class="o">&lt;</span><span class="n">ObjectQuery</span> <span class="n">OB</span><span class="o">-</span><span class="n">L1singleSpectrum</span><span class="o">&gt;</span> <span class="n">relative</span> <span class="n">to</span> <span class="o">&lt;</span><span class="n">ObjectQuery</span> <span class="n">OB</span><span class="o">-</span><span class="n">Run</span><span class="o">&gt;</span> <span class="n">since</span> <span class="n">it</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">parent</span><span class="o">.</span>
</code></pre></div></p>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy"], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>